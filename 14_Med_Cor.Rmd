# Medidas de correlación \label{correl}

En este capítulo se mostrará cómo obtener el coeficiente de correlación lineal para variables cuantitativas.

## Función `cor` \index{cor} \index{correlación}
La función `cor` permite calcular el coeficiente de correlación de Pearson, Kendall o Spearman para dos variables cuantitativas. La estructura de la función es la siguiente.

```{r, eval=F}
cor(x, y, use="everything",
    method=c("pearson", "kendall", "spearman"))
```

Los parámetos de la función son:

- `x, y`: vectores cuantitativos.
- `use`: parámetro que indica lo que se debe hacer cuando se presenten registros `NA` en alguno de los vectores. Las diferentes posibilidades son: `everything`, `all.obs`, `complete.obs`, `na.or.complete` y `pairwise.complete.obs`, el valor por defecto es `everything`.
- `method`: tipo de coeficiente de correlación a calcular, por defecto es `pearson`, otros valores posibles son `kendall` y `spearman`.

### Ejemplo {-}
Calcular el coeficiente de correlación de Pearson para las variables área y precio de la base de datos sobre apartamentos usados.

Lo primero que se debe hacer es cargar la base de datos usando la url apropiada. Luego de esto se usa la función `cor` sobre las variables de interés. A continuación se muestra el código necesario.

```{r}
url <- 'https://raw.githubusercontent.com/fhernanb/datos/master/aptos2015'
datos <- read.table(file=url, header=T)
cor(x=datos$mt2, y=datos$precio)
```

Del resultado anterior vemos que existe una correlación de `r cor(x=datos$mt2, y=datos$precio)` entre las dos variables, eso significa que apartamentos de mayor área tienden a tener precios de venta más alto. Este resultado se ilustra en la Figura \@ref(fig:disp), se nota claramente que la nube de puntos tiene un pendiente positiva y por eso el signo del coeficiente de correlación.

A continuación el código para generar la Figura \@ref(fig:disp).

```{r disp, fig.cap='Diagrama de dispersión para precio versus área de los apartamentos usados.', fig.asp=0.6, fig.width =10}
with(datos, plot(x=mt2, y=precio, pch=20, col='blue',
                 xlab='Área del apartamento', las=1,
                 ylab='Precio del apartamento (millones COP)'))
```

### Ejemplo {-}
Para las mismas variables del ejemplo anterior calcular los coeficientes de correlación Kendall y Spearman.

A continuación el código para obtener lo solicitado.

```{r}
cor(x=datos$mt2, y=datos$precio, method='pearson')
cor(x=datos$mt2, y=datos$precio, method='kendall')
cor(x=datos$mt2, y=datos$precio, method='spearman')
```

### Ejemplo {-}
Para la base de datos de apartamentos usados, ¿cuáles de las variables cuantitativas tienen mayor correlación?

Lo primero que debemos hacer es determinar cuáles son las cuantitativas de la base de datos. Para obtener información de las variables que están almacenadas en el marco de datos llamado `datos` usamos la función `str` que muestra la estructura interna de objeto.

```{r}
str(datos)
```

Del anterior resultado vemos que las variables precio, mt2, alcobas, banos, administracion y avaluo son las variables cuantitativas, las restantes son cualitativas (nominal u ordinal). Las posiciones de las variables cuantitativas en el objeto `datos` son 1, 2, 5, 6, 9, 10, así podemos construir un marco de datos sólo con la información cuantitativa, a continuación el código usado.

```{r}
datos.cuanti <- datos[, c(1, 2, 5, 6, 9, 10)]
M <- round(cor(datos.cuanti), digits=2)
M
```

El anterior resultado representa la matriz de correlaciones, se nota claramente que la mayor correlación corresponde a las variables precio y área del apartamento. Es posible representar la matriz `M` de correlaciones por medio de una figura, a continuación el código para obtener su representación gráfica.

```{r corplot, fig.cap='Matriz de coeficientes de correlación.', fig.asp=0.6, fig.width =10}
library('corrplot')  # Para cargar el paquete corrplot
corrplot(M, method='ellipse', type='upper')
```










