# Prueba de hipótesis.

En este capítulo se muestran las funciones que hay disponibles en \proglang{R} para realizar prueba de hipótesis para:

1. la media $\mu$,
2. la proporción $p$,
3. la varianza $\sigma^2$,
4. la diferencia de medias $\mu_1-\mu_2$ para muestras independientes y dependientes (o pareadas),
5. la diferencia de proporciones $p_1 - p_2$, y 
6. la razón de varianzas $\sigma_1^2 / \sigma_2^2$.


## Prueba de hipótesis para $\mu$ de una población normal

### Ejemplo {-}
Para verificar si el proceso de llenado de bolsas de café con 500  gramos está operando correctamente se toman aleatoriamente muestras de tamaño diez cada cuatro horas. Una muestra de bolsas está compuesta por las siguientes observaciones:

502, 501, 497, 491, 496, 501, 502, 500, 489, 490.

¿Está el proceso llenando bolsas conforme lo dice la envoltura? Use un nivel de significancia del 5%.


Lo primero es explorar si la muestra proviene de una distribución normal, para eso ingresamos los datos y usamos la función `ad.test` como se muestra a continuación.

```{r}
contenido <- c(510, 492, 494, 498, 492,
               496, 502, 491, 507, 496) 

require(nortest) # Se debe haber instalado antes nortest
ad.test(contenido)
```

Como el valor-P de la prueba Anderson-Darlin es 20% y mayor que 5%, se puede asumir que la muestra proviene de una población normal, así nos interesa probar lo siguiente:

$$H_0: \mu = 500 \quad km$$
$$H_1: \mu \neq 500 \quad km$$
La prueba de hipótesis se puede realizar usando la función `t.test` por medio del siguiente código.

```{r}
t.test(contenido, alternative='two.sided',
       conf.level=0.95, mu=500)
```

Como el valor-P es 30% y mayor que el nivel de significancia 5%, no se rechaza la hipótesis nula, es decir, las evidencias no son suficientes para afirmar que el proceso de llenando no está cumpliendo con lo impreso en la envoltura. 


## Prueba de hipótesis para $\mu$ con muestras grandes

### Ejemplo {-}
Se afirma que los automóviles recorren en promedio más de 20000 kilómetros por año pero usted cree que el promedio es en realidad menor. Para probar tal afirmación se pide a una muestra de 100 propietarios de automóviles seleccionada de manera aleatoria que lleven un registro de los kilómetros que recorren. 

¿Estaría usted de acuerdo con esta afirmación, si la muestra aleatoria indicara un promedio de 23500 kilómetros y una desviación estándar de 3900 kilómetros? Utilice un valor P en su conclusión y use una significancia del 3%.

En este problema interesa

$$H_0: \mu \ge 2000 \quad km$$
$$H_1: \mu < 2000 \quad km$$
Para calcular el estadístico y su valor-P se usa el siguiente código.
```{r}
xbarra <- 19500  # Datos del problema
desvia <- 3900
n <- 100
mu <- 20000

est <- (xbarra - mu) / (desvia / sqrt(n))
est  # Para obtener el valor del estadístico
pnorm(est)  # Para obtener el valor-P
```
Como el valor-P es mayor que el nivel de significancia, no hay evidencias suficientes para pensar que ha disminuido el recorrido anual de los autos.

## Prueba de hipótesis para $p$

### Ejemplo {-}
Un fabricante de un quitamanchas afirma que su producto quita 90% de todas las manchas. Para poner a prueba esta afirmación se toman 200 camisetas manchadas de las cuales a solo 174  les desapareció la mancha. Pruebe la afirmación del fabricante a un nivel $\alpha=0.05$.

En este problema interesa probar lo siguiente:

$$H_0: p = 0.90$$
$$H_1: p < 0.90$$
La función `prop.test` se puede usar para realizar la prueba anterior.
```{r}
prop.test(x=174, n=200, p=0.9, alternative='less',
          conf.level=0.95, correct=FALSE)
```

Como el valor-P es mayor que $\alpha$ no se rechaza la hipótesis nula y se puede asumir que el productor del detergente está diciendo la verdad.

Para entender lo que reporta la función `prop.test` se recomienda revisar este [enlace](https://www.r-bloggers.com/one-proportion-z-test-in-r/).

## Prueba de hipótesis para $\sigma^2$

### Ejemplo {-}

## Prueba de hipótesis para el cociente de varianzas $\sigma_1^2 / \sigma_2^2$

### Ejemplo {-}
Se realiza un estudio para comparar dos tratamientos que se aplicarán a frijoles crudos con el objetivo de reducir el tiempo de cocción.  El tratamiento T1 es a base de bicarbonato de sodio, el T2 es a base de cloruro de sodio o sal común. La variable respuesta es el tiempo de cocción en minutos. Los datos se muestran en la tabla. ¿Son las varianzas de los tiempos iguales o diferentes? Usar $\alpha=0.03$.

T1: 76, 85, 74, 78, 82, 75, 82.

T2: 57, 67, 55, 64, 61, 63, 63.

En este problema interesa probar:

$$H_0: \sigma_1^2 / \sigma_2^2 = 1$$
$$H_1: \sigma_1^2 / \sigma_2^2 \neq 1$$

Para ingresar los datos se hace lo siguiente:

```{r}
T1 <- c(76, 85, 74,78, 82, 75, 82) 
T2 <- c(57, 67, 55, 64, 61, 63, 63)
```

Primero se debe explorar si las muestras provienen de una población normal, para esto se construyen los QQplot.

```{r frijoles1, fig.cap='QQplot para los tiempos de cocción.', fig.asp=0.8, fig.width=6}
q1 <- qqnorm(T1, plot.it=FALSE)
q2 <- qqnorm(T2, plot.it=FALSE)
plot(range(q1$x, q2$x), range(q1$y, q2$y), type="n", las=1,
     xlab='Theoretical Quantiles', ylab='Sample Quantiles')
points(q1, pch=19)
points(q2, col="red", pch=19)
qqline(T1)
qqline(T2, col="red")
legend('topleft', legend=c('T1', 'T2'), bty='n',
       col=c('black', 'red'), pch=19)
```

A continuación el código para aplicar la prueba de normalidad Kolmogorov-Smirnov, a continuación el código usado. 
```{r}
require(nortest)
lillie.test(T1)$p.value
lillie.test(T2)$p.value
```

Del QQplot mostrado en la Figura \@ref(fig:cocvar1) y las pruebas de normalidad se observa que se pueden asumir poblaciones normales.

La función `var.test` se puede usar para probar $H_0$, a continuación el código para realizar la prueba.

```{r}
var.test(T1, T2, ratio=1, alternative="two.sided",
         conf.level=0.97)
```

Como el valor-P es 0.9897 (reportado como 1), muy superior al nivel $\alpha$ de significancia, se puede concluir que las varianzas son similares.

### Ejemplo {-}
El arsénico en agua potable es un posible riesgo para la salud. Un artículo reciente reportó concentraciones de arsénico en agua potable en partes por billón (ppb) para 10 comunidades urbanas y 10 comunidades rurales. Los datos son los siguientes:

Urbana: 3, 7, 25, 10, 15, 6, 12, 25, 15, 7

Rural: 48, 44, 40, 38, 33, 21, 20, 12, 1, 18

¿Son las varianzas de las concentraciones iguales o diferentes? Usar $\alpha=0.07$.

En este problema interesa probar:

$$H_0: \sigma_1^2 / \sigma_2^2 = 1$$
$$H_1: \sigma_1^2 / \sigma_2^2 \neq 1$$

Para ingresar los datos se hace lo siguiente:

```{r}
urb <- c(3, 7, 25, 10, 15, 6, 12, 25, 15, 7)
rur <- c(48, 44, 40, 38, 33, 21, 20, 12, 1, 18)
```

Primero se debe explorar si las muestras provienen de una población normal, para esto se construyen los QQplot.

```{r ars1, fig.cap='QQplot para las concentraciones de arsénico.', fig.asp=0.8, fig.width=6}
q1 <- qqnorm(urb, plot.it=FALSE)
q2 <- qqnorm(rur, plot.it=FALSE)
plot(range(q1$x, q2$x), range(q1$y, q2$y), type="n", las=1,
     xlab='Theoretical Quantiles', ylab='Sample Quantiles')
points(q1, pch=19)
points(q2, col="red", pch=19)
qqline(urb)
qqline(rur, col="red")
legend('topleft', legend=c('Urbana', 'Rural'), bty='n',
       col=c('black', 'red'), pch=19)
```

A continuación el código para aplicar la prueba de normalidad Kolmogorov-Smirnov, a continuación el código usado. 
```{r}
require(nortest)
lillie.test(urb)$p.value
lillie.test(rur)$p.value
```

Del QQplot mostrado en la Figura \@ref(fig:ars1) y las pruebas de normalidad se observa que se pueden asumir poblaciones normales.

La función `var.test` se puede usar para probar $H_0$, a continuación el código para realizar la prueba.

```{r}
var.test(urb, rur, ratio=1, alternative="two.sided",
         conf.level=0.93)
```

Como el valor-P es menor que $\alpha=0.07$ de significancia, se puede concluir que las varianzas no son iguales.


## Prueba de hipótesis para la diferencia de medias $\mu_1-\mu_2$ con varianzas iguales

### Ejemplo {-}
Retomando el ejemplo de los fríjoles, ¿existen diferencias entre los tiempos de cocción de los fríjoles con T1 y T2? Usar un nivel de significancia del 3%.


```{r frijoles2, fig.cap='Boxplot para los tiempos de cocción dado el tratamiento.', fig.asp=1, fig.width=4}
datos <- data.frame(tiempo=c(T1, T2), trat=rep(1:2, each=7))
boxplot(tiempo ~ trat, data=datos, las=1,
        xlab='Tratamiento', ylab='Tiempo (min)')
```


```{r}
t.test(T1, T2, alternative="two.sided", mu=0, 
       paired=FALSE, var.equal=TRUE, conf.level=0.97)
```


## Prueba de hipótesis para la diferencia de medias $\mu_1-\mu_2$ con varianzas diferentes

### Ejemplo {-}
Retomando el ejemplo de la concentración de arsénico en el agua, ¿existen diferencias entre las concentraciones de arsénico de la zona urbana y rual? Usar un nivel de significancia del 7%.

```{r ars2, fig.cap='Boxplot para las concentaciones de arsénico dada la zona.', fig.asp=1, fig.width=4}
datos <- data.frame(Concentracion=c(urb, rur),
                    Zona=rep(c('Urbana', 'Rural'), each=10))
boxplot(Concentracion ~ Zona, data=datos, las=1,
        xlab='Zona', ylab='Concentración arsénico (ppb)')
```


```{r}
t.test(urb, rur, alternative="two.sided", mu=0, 
       paired=FALSE, var.equal=FALSE, conf.level=0.93)
```


